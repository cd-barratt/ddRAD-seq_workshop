---
title: 'Tutorial: Downloading data'
output:
  html_document: default
  word_document: default
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, eval = FALSE,
                      echo=TRUE, warning=FALSE, message=FALSE,
                      tidy = TRUE, collapse = TRUE,
                      results = 'hold')
```
\
\

### Timings 
  1. Download Myotis escalerai (Escalera's bat) data (ca. 35 min)
  2. un-bzip the files and gzip them so they are ready for Stacks ( ca. 5 min)
  
All done in EVE cluster
  
\
\

### Objectives

Sometimes you may wish to download some already published data. Here we will download some data from the European Nucleotide Archive for 134 individuals of a European bat species, [Myotis escalarai](https://www.eurobats.org/about_eurobats/protected_bat_species/myotis_escalerai). The data are from paper published a couple of years ago [here](https://www.pnas.org/doi/10.1073/pnas.1820663116).

\
\

### 1. Download ENA data and get them in correct format for Stacks

This is all done in the EVE cluster. As with all of the EVE work we will do, it can be submitted via sbatch using the script templates we provide, but be sure to modify the email address and output paths to match your own details.


```{r}
#!/bin/bash                                                                                                                            
#SBATCH --job-name=download_ENA_data
#SBATCH --mail-user=christopher_david.barratt@uni-leipzig.de
#SBATCH --mail-type=BEGIN,END,FAIL,TIME_LIMIT
#SBATCH --output=~/work/ddRAD-seq_workshop/job_logs/%x-%j.log
#SBATCH --cpus-per-task=1 
#SBATCH --mem-per-cpu=25G
#SBATCH --time=24:00:00

# download ENA Data

cd ~/work/ddRAD-seq_workshop/data/Exercise_1/
cd ./raw

# Myotis escalerai bat data example download == 134 inds ddRADseq Paired end sequenced data, sbfI and nlaIII enzymes. Barcodes are inline inline adapters

#https://www.ebi.ac.uk/ena/browser/text-search?query=PRJEB29086
wget ftp://ftp.sra.ebi.ac.uk/vol1/run/ERR283/ERR2832479/BAT_01_NoIndex_L008_R1_001.fastq.bz2
wget ftp://ftp.sra.ebi.ac.uk/vol1/run/ERR283/ERR2832479/BAT_01_NoIndex_L008_R2_001.fastq.bz2

# these are bzip2ed, so need to be unzipped and then gzipped for Stacks
ml GCCcore/10.2.0
ml bzip2/1.0.8

bzip2 -d ./*
gzip ./*

```{r}
